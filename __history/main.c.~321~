#include <main.h>
#include <lcd.c>
#define SW1 PIN_A1 //PORTA RA1
#define SW2 PIN_A2 //PORTA RA2
#define SW3 PIN_A3 //PORTA RA3
#define SW4 PIN_A4 //PORTA RA4
#define SW5 PIN_A5 //PORTA RA5
#define bomba PIN_C4 //PORTA RC4
#define BLLCD PIN_C3 //luz backlight
#use fast_io(A)   // Configuración rápida del puerto A
#use fast_io(B)  // Configuración rápida del puerto B
#use fast_io(C) // Configuración rápida del puerto C

//******* Variables *******//
  int min=0, seg=0, tempo=10, onoff=10,suma=0, cont=0, counter=0;
      
#int_TIMER1
void temp1s(void)
{
  cont++;
  if (cont==2)  
  {
  seg++;
  cont=0;
  }
  set_timer1 (3036);
  if (seg==59)
  {
  seg=0;
  min++;
  }
}


// ************** Programa Principal ************** //
void main()
{

   set_tris_a(0x3E);
   set_tris_b(0x00);
   set_tris_c(0x00);
   
   setup_timer_1 (T1_INTERNAL | T1_DIV_BY_8);
   set_timer1 (3036);
   enable_interrupts(INT_TIMER1);
   enable_interrupts(global);
   lcd_init (); // Inicializa la libreria para manejar el LCD.
   output_high(BLLCD);
   printf ( LCD_PUTC, "\f" ); // Limpia la LCD.
   lcd_gotoxy(1,1);
   printf(lcd_putc,"Config Inicial");
   delay_ms(500);
             
   while(true){
   lcd_gotoxy(1,2);
   printf(lcd_putc,"TEMPO:%d",tempo);
   lcd_gotoxy(9,2);          //Acomoda cursor LCD
   printf(lcd_putc,"onoff:%d",onoff);
   
   if(!input(SW1)){
    delay_ms(100);              // <-----ANTIREBOTE AQUI!!!                   
   while(!input(SW1))
   {
   tempo--;
   output_high(BLLCD);
   counter=0;
   }
   }
   if(!input(SW2)){
   delay_ms(100);              // <-----ANTIREBOTE AQUI!!!                   
   while(!input(SW2))
   {
   delay_ms(1);
   tempo++;
   output_high(BLLCD);
   counter=0;
   }
   }
   if(!input(SW3))
   {
   delay_ms(100);              // <-----ANTIREBOTE AQUI!!!                   
   while(!input(SW3))
   {
   delay_ms(1);
   onoff--;
   output_high(BLLCD);
   counter=0;
   }
   }
   if(!input(SW4))
   {
   delay_ms(100);              // <-----ANTIREBOTE AQUI!!!                   
   while(!input(SW4))
   {
   delay_ms(1);
   onoff++;
   output_high(BLLCD);
   counter=0;
   }
   }
   if(!input(SW5)){
   delay_ms(100);              // <-----ANTIREBOTE AQUI!!!                   
   while(!input(SW5))
   {
   break;
   }
   }
   }
   while(true)
   { 
   lcd_gotoxy(1,2);
   printf(lcd_putc,"Tempo:%d",tempo);
   lcd_gotoxy(9,2);
   printf(lcd_putc,"off:%d:",onoff);
   lcd_gotoxy(1,1);
   printf(lcd_putc,"min:%d:",min);
 
   if (min==tempo)
   {
   output_high(bomba);
   suma= min+onoff;
   lcd_gotoxy(8,1);
   printf(lcd_putc,"Bomba on");
   lcd_gotoxy(1,1);
   printf(lcd_putc,"min:%d          ",min);
   }   
   if (min==suma)
   {
   output_low(bomba);
   lcd_gotoxy(8,1);
   printf(lcd_putc,"Bomba off ",);
   lcd_gotoxy(1,1);
   printf(lcd_putc,"min:%d:",min);
   min = 0;
   }    
   delay_ms(200);
   counter++;
   }
}


