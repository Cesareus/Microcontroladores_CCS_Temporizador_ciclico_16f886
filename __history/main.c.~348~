#include <main.h>
#include <lcd.c>
#define SW1 PIN_A1 //PORTA RA1
#define SW2 PIN_A2 //PORTA RA2
#define SW3 PIN_A3 //PORTA RA3
#define SW4 PIN_A4 //PORTA RA4
#define SW5 PIN_A5 //PORTA RA5
#define bomba PIN_C4 //PORTA RC4
#define BLLCD PIN_C3 //luz backlight
#use fast_io(A)   // Configuración rápida del puerto A
#use fast_io(B)  // Configuración rápida del puerto B
#use fast_io(C) // Configuración rápida del puerto C

//******* Variables *******//
  int min=0, seg=0, tempo=10, onoff=10,suma=0, cont=0;
void pausa (void);
Void ajustes(void);
#int_TIMER1
void temp1s(void)
{
  cont++;
  if (cont==2)  
  {
  seg++;
  cont=0;
  }
  set_timer1 (3036);
  if (seg==59)
  {
  seg=0;
  min++;
  }
}

void pausa (void){
while(1){
delay_ms(100);
if(input(START)){
output_high(ledstart);
delay_ms(5000);
output_low(ledstart);
return;
}}}

Void ajustes(void){
   lcd_gotoxy(1,1);
   printf(lcd_putc,"Config Inicial");
   delay_ms(500);
             
   while(true){
  
  if(tempo<10){
  lcd_gotoxy(1,2);
  printf(lcd_putc,"Time:%d ",tempo);}
  else{
  lcd_gotoxy(1,2);
  printf(lcd_putc,"Time:%d",tempo);}
  if(onoff<10){
  lcd_gotoxy(9,2);
  printf(lcd_putc,"onoff:%d ",onoff);}
  else{
  lcd_gotoxy(9,2);
  printf(lcd_putc,"onoff:%d",onoff);}
 
   if(!input(SW1)){
   delay_ms(500);
   tempo--;
   output_high(BLLCD);
   }
   if(!input(SW2)){
   delay_ms(500);                            
   tempo++;
   output_high(BLLCD);
   }
   if(!input(SW3))
   {
   delay_ms(500);                                
   onoff--;
   output_high(BLLCD);
   }
   if(!input(SW4))
   {
   delay_ms(500);                                
   onoff++;
   output_high(BLLCD);
   }
   if(!input(SW5)){
   delay_ms(500);
   enable_interrupts(INT_TIMER1);
   return;
   }
   }
}
// ************** Programa Principal ************** //
void main()
{

   set_tris_a(0x3E);
   set_tris_b(0x00);
   set_tris_c(0x00);
   
   setup_timer_1 (T1_INTERNAL | T1_DIV_BY_8);
   set_timer1 (3036);
   enable_interrupts(global);
   lcd_init (); // Inicializa la libreria para manejar el LCD.
   output_high(BLLCD);
   printf ( LCD_PUTC, "\f" ); // Limpia la LCD.
   printf ( LCD_PUTC, "press start" );
  

   while(true)
   { 
   lcd_gotoxy(1,2);
   printf(lcd_putc,"Time:%d",tempo);
   lcd_gotoxy(9,2);
   printf(lcd_putc,"onoff:%d",onoff);
   lcd_gotoxy(1,1);
   printf(lcd_putc,"min:%d",min);
    if(min==1){
   output_low(BLLCD);
   }
   
   if (min==tempo)
   {
    if(min==1){
   output_low(BLLCD);
   }
   output_high(bomba);
   suma= tempo+onoff;
   lcd_gotoxy(8,1);
   printf(lcd_putc,"Bomba on");
   lcd_gotoxy(1,1);
   printf(lcd_putc,"min:%d ",min);
   }   
   if (min==suma)
   {
   output_low(bomba);
   lcd_gotoxy(8,1);
   printf(lcd_putc,"Bomba off ",);
   lcd_gotoxy(1,1);
   printf(lcd_putc,"min:%d ",min);
   min = 0;
   }    
   delay_ms(200);
   }
}


